<Controls:MetroWindow
    x:Class="AmiKoWindows.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:fa="http://schemas.fontawesome.com/icons/"
    xmlns:p="clr-namespace:AmiKoWindows.Properties"
    xmlns:local="clr-namespace:AmiKoWindows"
    mc:Ignorable="d"
    Loaded="MainWindow_Loaded"
    Closed="MainWindow_Closed"
    Title="{x:Static p:Resources.appTitle}"
    TitleCharacterCasing="Normal"
    Height="1080" Width="1920"
    GlowBrush="Black"
    BorderThickness="1"
    AllowsTransparency="False"
    SaveWindowPosition="True"
    WindowStartupLocation="CenterScreen"
    WindowTransitionsEnabled="False"
    RenderOptions.ClearTypeHint="Enabled"
    TextOptions.TextFormattingMode="Display">

    <Window.Resources>
        <ResourceDictionary>
            <Style TargetType="{x:Type Window}">
                <Setter Property="FontFamily" Value="pack://application:,,,/Resources/font/Roboto-Regular.ttf" />
            </Style>

            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Style.xaml" />
                <ResourceDictionary Source="/Resources/Icon.xaml" />

                <ResourceDictionary>
                    <!-- Compendium, Favorites and Interactions -->
                    <DataTemplate x:Key="HtmlTemplate" DataType="Html">
                        <WebBrowser
                          x:Name="Browser"
                          Panel.ZIndex="900"
                          local:BrowserBehavior.Html="{Binding Path=HtmlText}"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          Navigating="WebBrowser_Navigating"
                          Loaded="WebBrowser_Loaded"
                          LoadCompleted="WebBrowser_LoadCompleted"
                          Margin="0,0,8,0" />
                    </DataTemplate>

                    <!-- Prescriptions -->
                    <DataTemplate x:Key="FormTemplate" DataType="Form">
                        <Grid x:Name="Manager"
                            Panel.ZIndex="900"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Name="Meta" Margin="7,7,7,4">
                              <Grid.ColumnDefinitions>
                                  <ColumnDefinition Width="2*" MinWidth="200" MaxWidth="350" />
                                  <ColumnDefinition Width="2*" MinWidth="200" MaxWidth="350" />
                              </Grid.ColumnDefinitions>
                              <!-- Contact (Patient) -->
                              <Grid Name="PatientInfo" Grid.Column="0" Margin="0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0">
                                    <Button
                                        Name="OpenAddressBookButton" Style="{StaticResource NoHighlightedButton}"
                                        Margin="0,1,0,1" HorizontalAlignment="Left" Click="OpenAddressBookButton_Click">
                                        <Label Margin="0" Padding="0" VerticalAlignment="Center" Content="{x:Static p:Resources.patientSearch}" />
                                    </Button>
                                </Grid>
                                <Grid Grid.Row="1">
                                    <StackPanel Margin="1,5,0,0" HorizontalAlignment="Left">
                                        <TextBlock Name="ContactFullname"></TextBlock>
                                        <TextBlock Name="ContactAddress"></TextBlock>
                                        <TextBlock Name="ContactPlace"></TextBlock>
                                        <TextBlock Name="ContactPersonalInfo"></TextBlock>
                                        <TextBlock Name="ContactPhone"></TextBlock>
                                        <TextBlock Name="ContactEmail"></TextBlock>
                                        <StackPanel Margin="1,16,0,0" HorizontalAlignment="Left">
                                            <TextBlock Name="PlaceDate"></TextBlock>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                              </Grid>
                              <!-- Account (Operator) -->
                              <Grid Name="AccountInfo" Grid.Column="1" Margin="0" DataContext="{Binding Path=ActiveAccount, UpdateSourceTrigger=PropertyChanged}">
                                  <DockPanel Margin="0,5,4,4">
                                      <Button Name="OpenProfileCardButton" HorizontalAlignment="Right" Style="{StaticResource NoHighlightedButton}"
                                          DockPanel.Dock="Top" Click="OpenProfileCardButton_Click" Cursor="Hand" Visibility="Collapsed">
                                          <Label Margin="0" Padding="0" VerticalAlignment="Center" Content="{x:Static p:Resources.msgProfileUnsetWarning}" />
                                      </Button>
                                      <StackPanel DockPanel.Dock="Top" Margin="0,0,0,0" HorizontalAlignment="Right">
                                          <TextBlock Name="AccountFullname" Text="{Binding Path=Fullname, Mode=OneWay}"></TextBlock>
                                          <TextBlock Name="AccountAddress" Text="{Binding Path=Address, Mode=OneWay}"></TextBlock>
                                          <TextBlock Name="AccountPlace" Text="{Binding Path=Place, Mode=OneWay}"></TextBlock>
                                          <TextBlock Name="AccountPhone" Text="{Binding Path=Phone, Mode=OneWay}"></TextBlock>
                                          <TextBlock Name="AccountEmail" Text="{Binding Path=Email, Mode=OneWay}"></TextBlock>
                                          <Image Name="AccountPicture" Height="64" Margin="1,13,0,0" HorizontalAlignment="Left" />
                                      </StackPanel>
                                  </DockPanel>
                              </Grid>
                            </Grid>

                            <Border Grid.Row="1" Margin="7,5,7,2" Padding="1" Background="Transparent" Style="{DynamicResource MainWindowBorder}" VerticalAlignment="Stretch" BorderThickness="1">
                                <ListBox
                                    Name="MedicationList" Style="{StaticResource MedicationListBox}" ItemContainerStyle="{StaticResource MedicationListBoxItem}"
                                    KeyboardNavigation.DirectionalNavigation="Cycle"
                                    ItemsSource="{Binding Path=MedicationListItems}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid VerticalAlignment="Top">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="32" />
                                                    <RowDefinition Height="Auto" MinHeight="32" />
                                                </Grid.RowDefinitions>
                                                <Grid Grid.Row="0" VerticalAlignment="Top">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition />
                                                        <ColumnDefinition Width="80" />
                                                    </Grid.ColumnDefinitions>
                                                    <StackPanel Grid.Column="0" VerticalAlignment="Top" HorizontalAlignment="Left">
                                                        <TextBlock Text="{Binding Path=Text}"
                                                            Margin="0,0,7,0" Padding="8,6,4,0" Width="Auto" FontWeight="Normal" VerticalAlignment="Bottom" HorizontalAlignment="Left" Focusable="False" />
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="1" VerticalAlignment="Top" HorizontalAlignment="Right" Orientation="Horizontal">
                                                        <Button
                                                            Name="PrintMedicationLabelButton" Style="{StaticResource WhiteIconButton}"
                                                            Margin="0,0,1,0" Height="28" Width="28" HorizontalAlignment="Right" VerticalAlignment="Bottom" Click="PrintMedicationLabelButton_Click"
                                                            Cursor="Hand">
                                                            <fa:ImageAwesome Name="PrintMedicationLabel" Icon="Solid_Print" Visibility="Visible" Foreground="DarkGray"
                                                                VerticalAlignment="Center" Margin="0" Height="14" Width="14" />
                                                        </Button>
                                                        <Button
                                                            Name="DeleteMedicationButton" Style="{StaticResource WhiteIconButton}"
                                                            Margin="0,0,1,0" Height="28" Width="28" HorizontalAlignment="Right" VerticalAlignment="Bottom" Click="DeleteMedicationButton_Click"
                                                            Cursor="Hand">
                                                            <fa:ImageAwesome Name="DeleteMedication" Icon="Solid_Trash" Visibility="Visible" Foreground="DarkGray"
                                                                VerticalAlignment="Center" Margin="0" Height="14" Width="14" />
                                                        </Button>
                                                    </StackPanel>
                                                </Grid>
                                                <Grid Grid.Row="1" VerticalAlignment="Top">
                                                    <TextBox x:Name="MedicationCommentTextBox" Style="{StaticResource MedicationCommentTextBox}" Text="{Binding Path=Comment}"
                                                        TextWrapping="Wrap" AcceptsReturn="True" Height="Auto" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                                        TextChanged="MedicationCommentTextBox_TextChanged"
                                                        Controls:TextBoxHelper.Watermark="{x:Static p:Resources.comment}" />
                                                </Grid>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>

                            <Grid Margin="7,2,7,7" Grid.Row="2">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="1*" MinWidth="100" />
                                        <ColumnDefinition Width="3*" MinWidth="300" />
                                    </Grid.ColumnDefinitions>
                                    <Grid Margin="0,3,5,1">
                                        <Button
                                            Name="NewPrescriptionButton" Style="{StaticResource NoHighlightedButton}"
                                            Grid.Column="0" Margin="0" HorizontalAlignment="Left" Click="NewPrescriptionButton_Click" IsEnabled="False" Cursor="Hand">
                                            <Label Margin="0" Padding="0" VerticalAlignment="Center" Content="{x:Static p:Resources.newPrescription}"
                                                Cursor="{Binding ElementName=NewPrescriptionButton, Path=Cursor}" />
                                        </Button>
                                    </Grid>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                        <Grid Margin="0,3,6,1">
                                            <Button
                                                Name="CheckInteractionButton" Style="{StaticResource NoHighlightedButton}"
                                                Margin="0" HorizontalAlignment="Right" Click="CheckInteractionButton_Click" IsEnabled="False" Cursor="Hand">
                                                <Label Margin="0" Padding="0" VerticalAlignment="Center" Content="{x:Static p:Resources.checkInteractions}"
                                                  Cursor="{Binding ElementName=CheckInteractionButton, Path=Cursor}" />
                                            </Button>
                                        </Grid>
                                        <Grid Margin="6,3,3,1">
                                          <Button
                                              Name="SavePrescriptionButton" Style="{StaticResource NoHighlightedButton}"
                                              Margin="0" HorizontalAlignment="Right" Click="SavePrescriptionButton_Click" IsEnabled="False" Cursor="Hand">
                                              <Label Margin="0" Padding="0" VerticalAlignment="Center" Content="{x:Static p:Resources.save}" />
                                          </Button>
                                        </Grid>
                                        <Grid Margin="6,3,0,1">
                                            <Button
                                                Name="SendPrescriptionButton" Style="{StaticResource NoHighlightedButton}"
                                                Margin="0" HorizontalAlignment="Right"
                                                PreviewMouseLeftButtonDown="SendPrescriptionButton_PreviewMouseLeftButtonDown"
                                                IsEnabled="False" Cursor="Hand">
                                                <Label Margin="0" Padding="0" VerticalAlignment="Center" Content="{x:Static p:Resources.send}" />
                                            </Button>
                                        </Grid>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </DataTemplate>

                    <!-- Compendium, Favorites and Interactions -->
                    <DataTemplate x:Key="TitleListTemplate" DataType="Html">
                        <ListBox
                            x:Name="SectionTitleList" Style="{StaticResource SectionTitleListBox}"
                            KeyboardNavigation.DirectionalNavigation="Cycle" ItemsSource="{Binding Path=SectionTitleListItems}"
                            Margin="0,0,0,0" Padding="0,16,0,16"
                            Loaded="SectionTitleList_Loaded"
                            SelectionChanged="SectionTitleList_SelectionChanged">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="24">
                                        <TextBlock
                                            Text="{Binding Path=Title}" Margin="0" Padding="9,3,18,3" Foreground="{Binding Path=Color}"
                                            Height="18" VerticalAlignment="Center" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DataTemplate>
                    <!-- Prescriptions -->
                    <DataTemplate x:Key="FileListTemplate" DataType="Form">
                        <ListBox
                            Name="FileNameList" Style="{StaticResource FileNameListBox}" ItemContainerStyle="{StaticResource FileNameListBoxItem}" ItemsSource="{Binding Path=FileNameListItems}"
                            SelectionChanged="FileNameList_SelectionChanged" KeyDown="FileNameList_KeyDown" Loaded="FileNameList_Loaded"
                            AllowDrop="True"
                            PreviewMouseLeftButtonDown="FileNameList_PreviewMouseLeftButtonDown" PreviewMouseLeftButtonUp="FileNameList_PreviewMouseLeftButtonUp" MouseMove="FileNameList_MouseMove"
                            DragEnter="FileNameList_DragEnter" DragLeave="FileNameList_DragLeave" DragOver="FileNameList_DragOver" Drop="FileNameList_Drop"
                            Cursor="Arrow">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Height="24" Orientation="Horizontal">
                                        <TextBlock
                                            Text="{Binding Path=Name}" Margin="0" Padding="9,3,18,3"
                                            Height="18" VerticalAlignment="Center" Cursor="Hand">
                                            <TextBlock.ContextMenu>
                                                <ContextMenu Name="ItemContextMenu">
                                                    <MenuItem Header="{Binding Path=Name}" Focusable="False" IsEnabled="False" />
                                                    <MenuItem Header="{x:Static p:Resources.delete}" Click="FileNameContextMenuItem_Click" />
                                                </ContextMenu>
                                            </TextBlock.ContextMenu>
                                        </TextBlock>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DataTemplate>
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Controls:MetroWindow.Flyouts>
        <Controls:FlyoutsControl>
            <Controls:Flyout x:Name="FlyoutMenu" Header="Menu" Position="Left" Width="200" IsOpen="False"
                             IsAutoCloseEnabled="True">
                <Border BorderBrush="White" BorderThickness="0,1,0,0">
                    <StackPanel Orientation="Vertical">
                        <MenuItem Header="{x:Static p:Resources.update}" Name="Update" Click="MenuItem_Click"
                                  Foreground="White" Height="28" Margin="10,20,10,10" Cursor="Hand">
                            <MenuItem.Icon>
                                <Rectangle Height="16" Width="16" Fill="White">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Visual="{StaticResource appbar_refresh}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="{x:Static p:Resources.report}" Name="Report" Click="MenuItem_Click"
                                  Foreground="White" Height="28" Margin="10" Cursor="Hand">
                            <MenuItem.Icon>
                                <Rectangle Height="16" Width="16" Fill="White">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Visual="{StaticResource appbar_book}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="{x:Static p:Resources.accountManagement}" Name="AccountAddress" Click="MenuItem_Click"
                                  Foreground="White" Height="28" Margin="10" Cursor="Hand">
                            <MenuItem.Icon>
                                <Rectangle Height="16" Width="16" Fill="White">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Visual="{StaticResource appbar_settings}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="{x:Static p:Resources.feedback}" Name="Feedback" Click="MenuItem_Click"
                                  Foreground="White" Height="28" Margin="10" Cursor="Hand">
                            <MenuItem.Icon>
                                <Rectangle Height="16" Width="16" Fill="White">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Visual="{StaticResource appbar_email_hardedge}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="{x:Static p:Resources.settings}" Name="Settings" Click="MenuItem_Click"
                                  Foreground="White" Height="28" Margin="10" Cursor="Hand">
                            <MenuItem.Icon>
                                <Rectangle Height="16" Width="16" Fill="White">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Visual="{StaticResource appbar_settings}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="{x:Static p:Resources.about}" Name="About" Click="MenuItem_Click"
                                  Foreground="White" Height="28" Margin="10" Cursor="Hand">
                            <MenuItem.Icon>
                                <Rectangle  Height="16" Width="16" Fill="White">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Visual="{StaticResource appbar_at}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </MenuItem.Icon>
                        </MenuItem>
                    </StackPanel>
                </Border>
            </Controls:Flyout>

            <Controls:Flyout
                x:Name="AddressBook"
                Position="Top" Width="700" Height="600" Theme="Adapt" IsOpen="{Binding Path=HasBook}"
                IsModal="True"
                AnimateOpacity="True"
                TitleVisibility="Collapsed"
                CloseButtonVisibility="Collapsed"
                Margin="0,40,0,0"
                RenderTransformOrigin="0,0"
                AreAnimationsEnabled="True"
                IsAutoCloseEnabled="False"
                ClosingFinished="AddressBookControl_ClosingFinished">
                <local:AddressBookControl />
            </Controls:Flyout>

            <Controls:Flyout
                x:Name="ProfileCard"
                Position="Top" Width="450" Height="580" Theme="Adapt" IsOpen="{Binding Path=HasCard}"
                IsModal="True"
                AnimateOpacity="True"
                TitleVisibility="Collapsed"
                CloseButtonVisibility="Collapsed"
                Margin="0,40,0,0"
                RenderTransformOrigin="0,0"
                AreAnimationsEnabled="True"
                IsAutoCloseEnabled="False"
                ClosingFinished="ProfileCardControl_ClosingFinished">
                <local:ProfileCardControl />
            </Controls:Flyout>
            <Controls:Flyout
                x:Name="SettingsCard"
                Position="Top" Width="450" Height="350" Theme="Adapt" IsOpen="{Binding Path=HasSettings}"
                IsModal="True"
                AnimateOpacity="True"
                TitleVisibility="Collapsed"
                CloseButtonVisibility="Collapsed"
                Margin="0,40,0,0"
                RenderTransformOrigin="0,0"
                AreAnimationsEnabled="True"
                IsAutoCloseEnabled="False"
                ClosingFinished="ProfileCardControl_ClosingFinished">
                <local:SettingsCardControl />
            </Controls:Flyout>
        </Controls:FlyoutsControl>
    </Controls:MetroWindow.Flyouts>

    <Controls:MetroWindow.LeftWindowCommands>
        <Controls:WindowCommands>
            <ToggleButton Style="{StaticResource FlyoutToggleButton}" IsChecked="{Binding ElementName=FlyoutMenu, Path=IsOpen}" Cursor="Hand">
            </ToggleButton>
        </Controls:WindowCommands>
    </Controls:MetroWindow.LeftWindowCommands>

    <Grid x:Name="MainGrid" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
        <Border Margin="0,0,0,29" Padding="0" Background="Transparent" Style="{DynamicResource MainWindowBorder}">
            <DockPanel LastChildFill="True">
                <Border DockPanel.Dock="Top" Background="Transparent" Style="{DynamicResource MainWindowBorder}" BorderThickness="1,1,1,1" HorizontalAlignment="Stretch">
                    <Grid>
                        <ToolBar ToolBarTray.IsLocked="True" HorizontalAlignment="Left">
                            <ToggleButton Name="Compendium" Style="{StaticResource StateSelectButton}" Click="StateButton_Click" Margin="6,6,0,6">
                                <StackPanel Orientation="Horizontal">
                                    <Image Name="CompendiumIcon" Width="16" Source="/Resources/img/aips32x32_dark.png" />
                                    <Label VerticalAlignment="Center" Content="{x:Static p:Resources.compendium}" />
                                </StackPanel>
                            </ToggleButton>
                            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
                            <ToggleButton Name="Favorites" Style="{StaticResource StateSelectButton}" Click="StateButton_Click" Margin="0,6,0,6">
                                <StackPanel Orientation="Horizontal">
                                    <Image Name="FavoritesIcon" Width="16" Source="/Resources/img/favorites32x32_dark.png" />
                                    <Label VerticalAlignment="Center" Content="{x:Static p:Resources.favorites}" />
                                </StackPanel>
                            </ToggleButton>
                            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
                            <ToggleButton Name="Interactions" Style="{StaticResource StateSelectButton}" Click="StateButton_Click" Margin="0,6,0,6">
                                <StackPanel Orientation="Horizontal">
                                    <Image Name="InteractionsIcon"  Width="16" Source="/Resources/img/interactions32x32_dark.png" />
                                    <Label VerticalAlignment="Center" Content="{x:Static p:Resources.interactions}" />
                                </StackPanel>
                            </ToggleButton>
                            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
                            <ToggleButton Name="Prescriptions" Style="{StaticResource StateSelectButton}" Click="StateButton_Click" Margin="0,6,0,6">
                                <StackPanel Orientation="Horizontal">
                                    <Image Name="PrescriptionsIcon" Width="16" Source="/Resources/img/prescriptions64x64.png" />
                                    <Label VerticalAlignment="Center" Content="{x:Static p:Resources.prescriptions}" />
                                </StackPanel>
                            </ToggleButton>
                        </ToolBar>
                        <Button Name="PrintPrescriptionButton" HorizontalAlignment="Right" Style="{StaticResource PrintIconButton}"
                            Click="PrintPrescriptionButton_Click" IsEnabled="False">
                            <fa:ImageAwesome Name="PrintPrescription" Icon="Solid_Print" Visibility="Visible" Foreground="LightGray"
                                VerticalAlignment="Center" Margin="0" Height="18" Width="18" />
                        </Button>
                    </Grid>
                </Border>

                <Grid VerticalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" MinWidth="200" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="4*" MinWidth="480" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="2*" MinWidth="190" />
                    </Grid.ColumnDefinitions>

                    <DockPanel Grid.Column="0" LastChildFill="True">
                        <DockPanel DockPanel.Dock="Top" Height="50" Background="Transparent">
                            <TextBox x:Name="SearchTextBox" Style="{StaticResource SearchTextBox}"
                                     TextChanged="SearchBox_TextChanged" PreviewMouseDown="OnSearchTextBox_PreviewMouseDown"
                                     Controls:TextBoxHelper.Watermark="{Binding Path=SearchTextBoxWaterMark, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="6,3,6,0">
                            </TextBox>
                        </DockPanel>

                        <ToggleButton DockPanel.Dock="Top" Style="{StaticResource QuerySelectButton}" Name="TitleQuerySelectButton" Cursor="Hand" Click="QuerySelectButton_Click">
                            <TextBlock Style="{StaticResource QuerySelectButtonText}">
                                <Label VerticalAlignment="Center" Content="{x:Static p:Resources.butTitle}" />
                            </TextBlock>
                        </ToggleButton>
                        <ToggleButton DockPanel.Dock="Top" Style="{StaticResource QuerySelectButton}" Name="AuthorQuerySelectButton" Cursor="Hand" Click="QuerySelectButton_Click">
                            <TextBlock Style="{StaticResource QuerySelectButtonText}">
                                <Label VerticalAlignment="Center" Content="{x:Static p:Resources.butAuthor}" />
                            </TextBlock>
                        </ToggleButton>
                        <ToggleButton DockPanel.Dock="Top" Style="{StaticResource QuerySelectButton}" Name="AtcCodeQuerySelectButton" Cursor="Hand" Click="QuerySelectButton_Click">
                            <TextBlock Style="{StaticResource QuerySelectButtonText}">
                                <Label VerticalAlignment="Center" Content="{x:Static p:Resources.butAtccode}" />
                            </TextBlock>
                        </ToggleButton>
                        <ToggleButton DockPanel.Dock="Top" Style="{StaticResource QuerySelectButton}" Name="RegNrQuerySelectButton" Cursor="Hand" Click="QuerySelectButton_Click">
                            <TextBlock Style="{StaticResource QuerySelectButtonText}">
                                <Label VerticalAlignment="Center" Content="{x:Static p:Resources.butRegnr}" />
                            </TextBlock>
                        </ToggleButton>
                        <ToggleButton DockPanel.Dock="Top" Style="{StaticResource QuerySelectButton}" Name="ApplicationQuerySelectButton" Cursor="Hand" Click="QuerySelectButton_Click">
                            <TextBlock Style="{StaticResource QuerySelectButtonText}">
                                <Label VerticalAlignment="Center" Content="{x:Static p:Resources.butTherapy}" />
                            </TextBlock>
                        </ToggleButton>
                        <ToggleButton DockPanel.Dock="Top" Style="{StaticResource QuerySelectButton}" Name="FulltextQuerySelectButton" Cursor="Hand" Click="QuerySelectButton_Click">
                            <TextBlock Style="{StaticResource QuerySelectButtonText}">
                                <Label VerticalAlignment="Center" Content="{x:Static p:Resources.butFulltext}" />
                            </TextBlock>
                        </ToggleButton>

                        <ListBox
                            x:Name="SearchResult"
                            Style="{StaticResource SearchListBox}" ItemContainerStyle="{StaticResource SearchListBoxItem}"
                            ItemsSource="{Binding Path=SearchResultItems}" SelectionChanged="OnSearchItem_Selection"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            Margin="6,6,6,0" Padding="0,7,0,0" IsTabStop="False">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <CheckBox Style="{StaticResource ListCheckBox}"
                                                  IsChecked="{Binding Path=IsFavorite, Mode=TwoWay}"
                                                  Checked="FavoriteCheckBox_Checked" Unchecked="FavoriteCheckBox_Checked"
                                                  Height="14" Margin="0,0,4,0" />
                                        <StackPanel Orientation="Vertical">
                                            <TextBlock Text="{Binding Path=Text}" VerticalAlignment="Center" />
                                            <ListBox ItemContainerStyle="{StaticResource SearchListBoxChildItem}"
                                                     ItemsSource="{Binding Path=ChildItems}"
                                                     ScrollViewer.CanContentScroll="False"
                                                     SelectionChanged="OnSearchChildItem_Selection"
                                                     PreviewMouseDown="OnSearchResultChild_PreviewMouseDown">
                                                <ListBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock
                                                            Name="ItemName" Style="{StaticResource SearchListBoxChildItemText}" Text="{Binding Path=Text}" Foreground="{Binding Path=Color}"
                                                            ContextMenuClosing="SearchChildItemContextMenu_Closing"
                                                            MouseRightButtonDown="SearchChildItem_MouseRightButtonDown"
                                                            MouseLeftButtonDown="SearchChildItem_MouseLeftButtonDown">
                                                            <TextBlock.ContextMenu>
                                                                <ContextMenu Name="ItemContextMenu">
                                                                    <MenuItem Header="{Binding Path=Text}" Focusable="False" IsEnabled="False" />
                                                                    <MenuItem Header="{x:Static p:Resources.prescription}" Click="SearchChildItemContextMenuItem_Click" />
                                                                </ContextMenu>
                                                            </TextBlock.ContextMenu>
                                                        </TextBlock>
                                                    </DataTemplate>
                                                </ListBox.ItemTemplate>
                                            </ListBox>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DockPanel>

                    <GridSplitter HorizontalAlignment="Right" VerticalAlignment="Stretch" ResizeBehavior="PreviousAndNext" Grid.Column="1" Width="3" IsTabStop="False" Style="{DynamicResource MainWindowGridSplitter}" />

                    <ContentControl x:Name="MainArea" Grid.Column="2"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        IsTabStop="False">
                        <ContentControl.Style>
                            <Style TargetType="{x:Type ContentControl}">
                                <Setter Property="ContentTemplate" Value="{StaticResource HtmlTemplate}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=Mode}" Value="Html">
                                        <Setter Property="ContentTemplate" Value="{StaticResource HtmlTemplate}" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=Mode}" Value="Form">
                                        <Setter Property="ContentTemplate" Value="{StaticResource FormTemplate}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>

                    <GridSplitter HorizontalAlignment="Left" VerticalAlignment="Stretch" ResizeBehavior="PreviousAndNext" Grid.Column="3" Width="3" IsTabStop="False" Style="{DynamicResource MainWindowGridSplitter}" />

                    <ContentControl x:Name="RightArea" Grid.Column="4"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        IsTabStop="False">
                        <ContentControl.Style>
                            <Style TargetType="{x:Type ContentControl}">
                                <Setter Property="ContentTemplate" Value="{StaticResource TitleListTemplate}" />
                                <Setter Property="IsTabStop" Value="False" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=Mode}" Value="Html">
                                        <Setter Property="ContentTemplate" Value="{StaticResource TitleListTemplate}" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=Mode}" Value="Form">
                                        <Setter Property="ContentTemplate" Value="{StaticResource FileListTemplate}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>
                </Grid>
            </DockPanel>
        </Border>

        <StatusBar x:Name="StatusBar" VerticalAlignment="Bottom" DockPanel.Dock="Bottom" Height="28" Padding="0,0,0,5">
            <StatusBarItem DockPanel.Dock="Left" Margin="7,0,0,0" Width="Auto">
                <TextBlock Text="{Binding Path=NetworkStatusText}" Foreground="White"></TextBlock>
            </StatusBarItem>
            <StatusBarItem DockPanel.Dock="Left" Margin="0,0,0,0" Width="Auto">
                <TextBlock Text="{Binding Path=DatabaseStatusText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="4,0,0,0" VerticalAlignment="Center"
                           HorizontalAlignment="Left"></TextBlock>
            </StatusBarItem>
            <fa:ImageAwesome DockPanel.Dock="Right" x:Name="Spinner" Icon="Solid_Star" Foreground="Yellow" Visibility="Visible" Spin="False"
                VerticalAlignment="Center" Margin="6,1,0,0" Height="14" Width="14" SpinDuration="2" />
        </StatusBar>
    </Grid>
</Controls:MetroWindow>
